@{
    ViewData["Title"] = "訂單確認 - 品渴茶鋪";
    var orderInfo = ViewData["OrderInfo"] as Dictionary<string, object>;
    
    if (orderInfo == null)
    {
        <div class="alert alert-danger">找不到訂單資訊</div>
        return;
    }
    
    var orderNumber = orderInfo["OrderNumber"]?.ToString() ?? "";
    var customerName = orderInfo["CustomerName"]?.ToString() ?? "";
    var customerPhone = orderInfo["CustomerPhone"]?.ToString() ?? "";
    var customerEmail = orderInfo["CustomerEmail"]?.ToString() ?? "";
    var customerAddress = orderInfo["CustomerAddress"]?.ToString() ?? "";
    var deliveryType = orderInfo["DeliveryType"]?.ToString() ?? "";
    var notes = orderInfo["Notes"]?.ToString() ?? "";
    var totalAmount = orderInfo["TotalAmount"];
    var orderStatus = orderInfo["OrderStatus"]?.ToString() ?? "";
    var paymentStatus = orderInfo["PaymentStatus"]?.ToString() ?? "";
    var paymentMethod = orderInfo["PaymentMethod"]?.ToString() ?? "";
    var createdAt = orderInfo["CreatedAt"];
    var orderDetails = orderInfo["OrderDetails"] as List<Dictionary<string, object>>;
}

<div class="order-confirmation-page">
    <div class="confirmation-container">
        <!-- 成功圖示 -->
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        
        <!-- 成功訊息 -->
        <h1 class="success-title">訂單送出成功！</h1>
        <p class="success-subtitle">感謝您的訂購，我們已收到您的訂單</p>
        
        <!-- 訂單編號 -->
        <div class="order-number-box">
            <span class="order-number-label">訂單編號：</span>
            <span class="order-number-value">@orderNumber</span>
        </div>
        
        <!-- 訂單狀態 -->
        <div class="order-status-box">
            <div class="status-item">
                <i class="fas fa-info-circle"></i>
                <span>訂單狀態：<strong>@orderStatus</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-credit-card"></i>
                <span>付款狀態：<strong>@paymentStatus</strong></span>
            </div>
        </div>
        
        <!-- 訂單詳細資訊 -->
        <div class="order-details-section">
            <h2 class="section-title">
                <i class="fas fa-receipt"></i>
                訂單詳細資訊
            </h2>
            
            <!-- 顧客資訊 -->
            <div class="info-card">
                <h3 class="card-title">顧客資訊</h3>
                <div class="info-row">
                    <span class="info-label">姓名：</span>
                    <span class="info-value">@customerName</span>
                </div>
                <div class="info-row">
                    <span class="info-label">電話：</span>
                    <span class="info-value">@customerPhone</span>
                </div>
                @if (!string.IsNullOrEmpty(customerEmail))
                {
                    <div class="info-row">
                        <span class="info-label">Email：</span>
                        <span class="info-value">@customerEmail</span>
                    </div>
                }
                @if (!string.IsNullOrEmpty(deliveryType))
                {
                    <div class="info-row">
                        <span class="info-label">取貨方式：</span>
                        <span class="info-value">
                            <strong style="color: @(deliveryType == "自取" ? "#28a745" : "#FF69B4");">
                                @deliveryType
                            </strong>
                        </span>
                    </div>
                }
                @if (!string.IsNullOrEmpty(customerAddress) && deliveryType == "外送")
                {
                    <div class="info-row">
                        <span class="info-label">外送地址：</span>
                        <span class="info-value">@customerAddress</span>
                    </div>
                }
                <div class="info-row">
                    <span class="info-label">付款方式：</span>
                    <span class="info-value">@paymentMethod</span>
                </div>
                @if (!string.IsNullOrEmpty(notes))
                {
                    <div class="info-row">
                        <span class="info-label">備註：</span>
                        <span class="info-value">@notes</span>
                    </div>
                }
                <div class="info-row">
                    <span class="info-label">訂單時間：</span>
                    <span class="info-value">@Convert.ToDateTime(createdAt).ToString("yyyy/MM/dd HH:mm")</span>
                </div>
            </div>
            
            <!-- 訂購品項 -->
            <div class="info-card">
                <h3 class="card-title">訂購品項</h3>
                @if (orderDetails != null && orderDetails.Count > 0)
                {
                    foreach (var detail in orderDetails)
                    {
                        var productName = detail["ProductName"]?.ToString() ?? "";
                        var sizeName = detail["SizeName"]?.ToString() ?? "";
                        var quantity = detail["Quantity"];
                        var unitPrice = detail["UnitPrice"];
                        var subtotal = detail["Subtotal"];
                        
                        <div class="product-item">
                            <div class="product-info">
                                <div class="product-name">@productName</div>
                                <div class="product-specs">
                                    @sizeName × @quantity
                                </div>
                            </div>
                            <div class="product-price">
                                <div class="unit-price">NT$ @unitPrice</div>
                                <div class="item-subtotal">小計：NT$ @subtotal</div>
                            </div>
                        </div>
                    }
                }
            </div>
            
            <!-- 訂單總計 -->
            <div class="order-total-box">
                <span class="total-label">訂單總金額</span>
                <span class="total-value">NT$ @totalAmount</span>
            </div>
        </div>
        
        <!-- 提示訊息 -->
        <div class="notice-box">
            <i class="fas fa-info-circle"></i>
            <div class="notice-content">
                <p><strong>溫馨提醒：</strong></p>
                <ul>
                    <li>請保留此訂單編號，以便查詢訂單狀態</li>
                    <li>訂單確認Email已發送至您的信箱 <strong>@customerEmail</strong></li>
                    <li>我們將盡快為您製作飲品</li>
                    @if (deliveryType == "自取")
                    {
                        <li><strong style="color: #28a745;">您選擇自取服務，請在訂單完成後到店取餐</strong></li>
                    }
                    else if (deliveryType == "外送")
                    {
                        <li><strong style="color: #FF69B4;">您選擇外送服務，我們將盡快為您安排配送</strong></li>
                    }
                    <li>如有任何問題，請撥打客服電話與我們聯繫</li>
                    <li>訂單完成後將以Email、簡訊或電話通知您</li>
                </ul>
            </div>
        </div>
        
        <!-- 操作按鈕 -->
        <div class="action-buttons">
            <a href="@Url.Action("Menu", "Home")" class="btn-continue">
                <i class="fas fa-shopping-bag"></i>
                繼續選購
            </a>
            <a href="@Url.Action("Index", "Home")" class="btn-home">
                <i class="fas fa-home"></i>
                返回首頁
            </a>
        </div>
    </div>
</div>

<style>
/* 訂單確認頁面樣式 */
.order-confirmation-page {
    min-height: 100vh;
    background: linear-gradient(135deg, #fff8f9 0%, #ffffff 100%);
    padding: 60px 20px;
}

.confirmation-container {
    max-width: 800px;
    margin: 0 auto;
}

/* 成功圖示 */
.success-icon {
    text-align: center;
    margin-bottom: 30px;
}

.success-icon i {
    font-size: 100px;
    color: #28a745;
    animation: successPulse 1s ease-in-out;
}

@@keyframes successPulse {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* 成功訊息 */
.success-title {
    text-align: center;
    font-size: 2.5rem;
    font-weight: 700;
    color: #28a745;
    margin-bottom: 15px;
}

.success-subtitle {
    text-align: center;
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 40px;
}

/* 訂單編號 */
.order-number-box {
    text-align: center;
    background: linear-gradient(135deg, #FFB6C1, #FFC0CB);
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
}

.order-number-label {
    font-size: 1.2rem;
    color: white;
    font-weight: 600;
}

.order-number-value {
    font-size: 1.8rem;
    color: #FFD700;
    font-weight: 700;
    margin-left: 15px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

/* 訂單狀態 */
.order-status-box {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
    justify-content: center;
    flex-wrap: wrap;
}

.status-item {
    background: white;
    padding: 15px 30px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-item i {
    font-size: 1.3rem;
    color: #FF69B4;
}

.status-item span {
    font-size: 1rem;
    color: #333;
}

/* 訂單詳細資訊 */
.order-details-section {
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.section-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #FF69B4;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* 資訊卡片 */
.info-card {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 25px;
    border-left: 5px solid #FF69B4;
}

.card-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e0e0e0;
}

.info-row {
    display: flex;
    padding: 10px 0;
    border-bottom: 1px solid #e0e0e0;
}

.info-row:last-child {
    border-bottom: none;
}

.info-label {
    font-weight: 600;
    color: #666;
    min-width: 120px;
}

.info-value {
    flex: 1;
    color: #333;
}

/* 產品品項 */
.product-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: white;
    border-radius: 10px;
    margin-bottom: 15px;
}

.product-item:last-child {
    margin-bottom: 0;
}

.product-info {
    flex: 1;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.product-specs {
    font-size: 0.95rem;
    color: #666;
}

.product-price {
    text-align: right;
}

.unit-price {
    font-size: 1rem;
    color: #666;
    margin-bottom: 5px;
}

.item-subtotal {
    font-size: 1.1rem;
    font-weight: 600;
    color: #FF69B4;
}

/* 訂單總計 */
.order-total-box {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #FF69B4, #FF1493);
    padding: 25px 30px;
    border-radius: 15px;
    margin-top: 30px;
}

.total-label {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
}

.total-value {
    font-size: 2rem;
    font-weight: 700;
    color: #FFD700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

/* 提示訊息 */
.notice-box {
    background: #fff3cd;
    border-left: 5px solid #ffc107;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    display: flex;
    gap: 15px;
}

.notice-box i {
    font-size: 1.5rem;
    color: #ffc107;
    margin-top: 5px;
}

.notice-content {
    flex: 1;
}

.notice-content p {
    margin: 0 0 10px 0;
    color: #856404;
}

.notice-content ul {
    margin: 0;
    padding-left: 20px;
    color: #856404;
}

.notice-content li {
    margin-bottom: 5px;
}

/* 操作按鈕 */
.action-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
}

.btn-continue,
.btn-home {
    padding: 15px 40px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
}

.btn-continue {
    background: linear-gradient(135deg, #FF69B4, #FF1493);
    color: white;
}

.btn-continue:hover {
    background: linear-gradient(135deg, #FF1493, #C71585);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 105, 180, 0.4);
    color: white;
}

.btn-home {
    background: linear-gradient(135deg, #999, #777);
    color: white;
}

.btn-home:hover {
    background: linear-gradient(135deg, #888, #666);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    color: white;
}

/* 響應式設計 */
@@media (max-width: 768px) {
    .order-confirmation-page {
        padding: 40px 15px;
    }
    
    .success-title {
        font-size: 1.8rem;
    }
    
    .success-subtitle {
        font-size: 1rem;
    }
    
    .order-number-value {
        font-size: 1.3rem;
        display: block;
        margin-left: 0;
        margin-top: 10px;
    }
    
    .order-status-box {
        flex-direction: column;
        gap: 10px;
    }
    
    .order-details-section {
        padding: 25px 20px;
    }
    
    .section-title {
        font-size: 1.5rem;
    }
    
    .info-row {
        flex-direction: column;
        gap: 5px;
    }
    
    .info-label {
        min-width: auto;
    }
    
    .product-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .product-price {
        width: 100%;
        text-align: left;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .btn-continue,
    .btn-home {
        width: 100%;
        justify-content: center;
    }
}
</style>

