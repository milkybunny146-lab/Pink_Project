@{
    ViewData["Title"] = "è³¼ç‰©è»Š - å“æ¸´èŒ¶é‹ª";
    
    // ä»ViewDataè·å–æ•°æ®
    var itemName = ViewData["ItemName"]?.ToString() ?? "åœçˆå¥¶èŒ¶";
    var mediumPrice = ViewData["MediumPrice"]?.ToString() ?? "70";
    var largePrice = ViewData["LargePrice"]?.ToString() ?? "90";
    var imageName = ViewData["ImageName"]?.ToString() ?? "orginal.jpg";
    var productInfo = ViewData["ProductInfo"] as Dictionary<string, object>;
    
    // ä»æ•°æ®åº“è·å–çš„äº§å“ä¿¡æ¯
    var productDescription = productInfo?["Description"]?.ToString() ?? "ç²¾é¸å„ªè³ªèŒ¶è‘‰ï¼Œæ‰‹å·¥èª¿è£½ï¼Œé¦™é†‡æ¿ƒéƒ";
    var categoryName = productInfo?["CategoryName"]?.ToString() ?? "";
    var isSpecial = productInfo?["IsSpecial"]?.ToString() == "True";
    
}

<div class="cart-page">
    <div class="cart-container">
        <div class="cart-header">
            <h1 class="cart-title">è³¼ç‰©è»Š</h1>
            <button class="back-btn" onclick="history.back()">
                <i class="fas fa-arrow-left"></i> è¿”å›èœå–®
            </button>
        </div>
        
        <div class="cart-content">
            <div class="product-section">
                <div class="product-image">
                    <img id="productImage" src="~/images/@imageName" alt="@itemName" />
                    @if (isSpecial)
                    {
                        <div class="special-badge">ç‰¹æ®Šå“é …</div>
                    }
                </div>
            </div>
            
            <div class="options-section">
                <div class="product-info">
                    <h2 id="productName">@itemName</h2>
                    @if (!string.IsNullOrEmpty(categoryName))
                    {
                        <p class="product-category">@categoryName</p>
                    }
                    <p class="product-description">@productDescription</p>
                </div>
                
                <div class="size-selection">
                    <h3>é¸æ“‡å°ºå¯¸</h3>
                    <div class="size-options">
                        <label class="size-option">
                            <input type="radio" name="size" value="medium" checked>
                            <span class="size-label">Medium</span>
                            <span class="size-price" id="mediumPrice">NT$ @mediumPrice</span>
                        </label>
                        <label class="size-option">
                            <input type="radio" name="size" value="large">
                            <span class="size-label">Large</span>
                            <span class="size-price" id="largePrice">NT$ @largePrice</span>
                        </label>
                    </div>
                </div>
                
                <div class="quantity-selection">
                    <h3>æ•¸é‡</h3>
                    <div class="quantity-controls">
                        <button type="button" class="quantity-btn" id="decreaseBtn">-</button>
                        <span class="quantity-display" id="quantityDisplay">1</span>
                        <button type="button" class="quantity-btn" id="increaseBtn">+</button>
                    </div>
                </div>
                
                <div class="total-section">
                    <div class="total-price">
                        <span class="total-label">ç¸½è¨ˆï¼š</span>
                        <span class="total-amount" id="totalAmount">NT$ 0</span>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button type="button" class="add-to-cart-btn" id="addToCartBtn">
                        <i class="fas fa-shopping-cart"></i>
                        åŠ å…¥è³¼ç‰©è»Š
                    </button>
                    <button type="button" class="buy-now-btn" id="buyNowBtn">
                        <i class="fas fa-bolt"></i>
                        ç«‹å³è³¼è²·
                    </button>
                </div>
            </div>
        </div>
        
        <!-- çµå¸³è¡¨å–®å€åŸŸ -->
        <div class="checkout-section" id="checkoutSection" style="display: none;">
            <div class="checkout-container">
                <h2 class="checkout-title">
                    <i class="fas fa-clipboard-list"></i>
                    å¡«å¯«è¨‚å–®è³‡è¨Š
                </h2>
                
                <form id="checkoutForm" method="post" action="/Home/CreateOrder">
                    <!-- éš±è—æ¬„ä½ï¼šè¨‚å–®è³‡è¨Š -->
                    <input type="hidden" id="hiddenProductName" name="ProductName" />
                    <input type="hidden" id="hiddenSize" name="Size" />
                    <input type="hidden" id="hiddenQuantity" name="Quantity" />
                    <input type="hidden" id="hiddenUnitPrice" name="UnitPrice" />
                    <input type="hidden" id="hiddenTotalAmount" name="TotalAmount" />
                    <input type="hidden" id="hiddenImageName" name="ImageName" />
                    
                    <div class="form-group">
                        <label for="customerName">
                            <i class="fas fa-user"></i>
                            å§“å <span class="required">*</span>
                        </label>
                        <input type="text" id="customerName" name="CustomerName" class="form-control" 
                               placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required />
                    </div>
                    
                    <div class="form-group">
                        <label for="customerPhone">
                            <i class="fas fa-phone"></i>
                            é›»è©± <span class="required">*</span>
                        </label>
                        <input type="tel" id="customerPhone" name="CustomerPhone" class="form-control" 
                               placeholder="ä¾‹å¦‚ï¼š0912345678" required 
                               pattern="[0-9]{10}" title="è«‹è¼¸å…¥10ä½æ•¸å­—çš„æ‰‹æ©Ÿè™Ÿç¢¼" />
                    </div>
                    
                    <div class="form-group">
                        <label for="customerEmail">
                            <i class="fas fa-envelope"></i>
                            é›»å­éƒµä»¶ <span class="required">*</span>
                        </label>
                        <input type="email" id="customerEmail" name="CustomerEmail" class="form-control" 
                               placeholder="ä¾‹å¦‚ï¼šexample@email.com" required />
                    </div>
                    
                    <div class="form-group">
                        <label for="deliveryType">
                            <i class="fas fa-truck"></i>
                            å–è²¨æ–¹å¼ <span class="required">*</span>
                        </label>
                        <select id="deliveryType" name="DeliveryType" class="form-control" required>
                            <option value="">è«‹é¸æ“‡å–è²¨æ–¹å¼</option>
                            <option value="è‡ªå–">è‡ªå–</option>
                            <option value="å¤–é€">å¤–é€</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="addressGroup" style="display: none;">
                        <label for="customerAddress">
                            <i class="fas fa-map-marker-alt"></i>
                            å¤–é€åœ°å€ <span class="required">*</span>
                        </label>
                        <input type="text" id="customerAddress" name="CustomerAddress" class="form-control" 
                               placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚ä¿¡ç¾©å€å¿ å­æ±è·¯äº”æ®µ123è™Ÿ" />
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentMethod">
                            <i class="fas fa-credit-card"></i>
                            ä»˜æ¬¾æ–¹å¼ <span class="required">*</span>
                        </label>
                        <select id="paymentMethod" name="PaymentMethod" class="form-control" required>
                            <option value="">è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼</option>
                            <option value="ç¾é‡‘">ç¾é‡‘</option>
                            <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                            <option value="è¡Œå‹•æ”¯ä»˜">è¡Œå‹•æ”¯ä»˜</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">
                            <i class="fas fa-comment"></i>
                            å‚™è¨»
                        </label>
                        <textarea id="notes" name="Notes" class="form-control" rows="3" 
                                  placeholder="æœ‰ä»»ä½•ç‰¹æ®Šéœ€æ±‚å—ï¼Ÿä¾‹å¦‚ï¼šç”œåº¦ã€å†°åº¦ã€å–é¤æ™‚é–“ç­‰"></textarea>
                    </div>
                    
                    <div class="order-summary">
                        <h3>è¨‚å–®æ‘˜è¦</h3>
                        <div id="cartItemsList" style="margin-bottom: 15px;">
                            <!-- è³¼ç‰©è»Šå•†å“åˆ—è¡¨å°‡å‹•æ…‹æ’å…¥æ­¤è™• -->
                        </div>
                        <div class="summary-item total">
                            <span>ç¸½é‡‘é¡ï¼š</span>
                            <span id="summaryTotal" class="total-price"></span>
                        </div>
                    </div>
                    
                    <!-- ä¿ç•™åŸæœ‰çš„éš±è—æ¬„ä½ä½œç‚ºå‚™ç”¨ -->
                    <div style="display: none;">
                        <span id="summaryProduct"></span>
                        <span id="summarySize"></span>
                        <span id="summaryQuantity"></span>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="cancelCheckoutBtn">
                            <i class="fas fa-times"></i>
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-check"></i>
                            ç¢ºèªè¨‚å–®
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
console.log('Script loaded!');

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM Content Loaded!');
    
    // ä½¿ç”¨æœåŠ¡å™¨ç«¯ä¼ é€’çš„æ•°æ®
    const itemName = '@Html.Raw(itemName)';
    const mediumPriceStr = '@mediumPrice';
    const largePriceStr = '@largePrice';
    const imageName = '@imageName';
    
    console.log('Raw Medium Price:', mediumPriceStr);
    console.log('Raw Large Price:', largePriceStr);
    
    const mediumPrice = parseInt(mediumPriceStr) || 0;
    const largePrice = parseInt(largePriceStr) || 0;
    
    console.log('Product loaded:', itemName);
    console.log('Medium Price (parsed):', mediumPrice);
    console.log('Large Price (parsed):', largePrice);
    
    // æ•¸é‡æ§åˆ¶
    let quantity = 1;
    const quantityDisplay = document.getElementById('quantityDisplay');
    const decreaseBtn = document.getElementById('decreaseBtn');
    const increaseBtn = document.getElementById('increaseBtn');
    
    console.log('Quantity Display:', quantityDisplay);
    console.log('Decrease Button:', decreaseBtn);
    console.log('Increase Button:', increaseBtn);
    
    if (!decreaseBtn || !increaseBtn || !quantityDisplay) {
        console.error('æŒ‰éˆ•æˆ–é¡¯ç¤ºå…ƒç´ æœªæ‰¾åˆ°ï¼');
        return;
    }
    
    // æ›´æ–°ç¸½åƒ¹å‡½æ•¸
    function updateTotal() {
        try {
            const selectedSizeInput = document.querySelector('input[name="size"]:checked');
            if (!selectedSizeInput) {
                console.error('æœªæ‰¾åˆ°é¸ä¸­çš„å°ºå¯¸ï¼');
                return;
            }
            
            const selectedSize = selectedSizeInput.value;
            const price = selectedSize === 'medium' ? mediumPrice : largePrice;
            const total = price * quantity;
            
            console.log('Update Total - Size:', selectedSize, 'Price:', price, 'Quantity:', quantity, 'Total:', total);
            
            const totalAmountElement = document.getElementById('totalAmount');
            if (totalAmountElement) {
                totalAmountElement.textContent = 'NT$ ' + total;
                console.log('ç¸½é‡‘é¡å·²æ›´æ–°ç‚º:', total);
            } else {
                console.error('æ‰¾ä¸åˆ°ç¸½é‡‘é¡å…ƒç´ ï¼');
            }
        } catch (error) {
            console.error('æ›´æ–°ç¸½åƒ¹æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        }
    }
    
    // åˆå§‹åŒ–ç¸½åƒ¹
    updateTotal();
    
    // æ¸›å°‘æŒ‰éˆ•
    decreaseBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('æ¸›å°‘æŒ‰éˆ•è¢«é»æ“Šï¼ç•¶å‰æ•¸é‡:', quantity);
        
        if (quantity > 1) {
            quantity--;
            quantityDisplay.textContent = quantity;
            console.log('æ–°æ•¸é‡:', quantity);
            updateTotal();
        } else {
            console.log('æ•¸é‡å·²ç¶“æ˜¯æœ€å°å€¼ 1');
        }
    });
    
    // å¢åŠ æŒ‰éˆ•
    increaseBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('å¢åŠ æŒ‰éˆ•è¢«é»æ“Šï¼ç•¶å‰æ•¸é‡:', quantity);
        
        quantity++;
        quantityDisplay.textContent = quantity;
        console.log('æ–°æ•¸é‡:', quantity);
        updateTotal();
    });
    
    // å°ºå¯¸é¸æ“‡
    const sizeInputs = document.querySelectorAll('input[name="size"]');
    console.log('æ‰¾åˆ°å°ºå¯¸é¸é …:', sizeInputs.length);
    
    sizeInputs.forEach(function(input) {
        input.addEventListener('change', function() {
            console.log('å°ºå¯¸å·²æ”¹è®Šç‚º:', input.value);
            updateTotal();
        });
    });
    
    // ==================== è³¼ç‰©è»ŠåŠŸèƒ½ ====================
    
    // å¾ LocalStorage è¼‰å…¥è³¼ç‰©è»Š
    function loadCart() {
        const cartData = localStorage.getItem('shoppingCart');
        return cartData ? JSON.parse(cartData) : [];
    }
    
    // å„²å­˜è³¼ç‰©è»Šåˆ° LocalStorage
    function saveCart(cart) {
        localStorage.setItem('shoppingCart', JSON.stringify(cart));
    }
    
    // æ¸…ç©ºè³¼ç‰©è»Š
    function clearCart() {
        localStorage.removeItem('shoppingCart');
    }
    
    // åŠ å…¥å•†å“åˆ°è³¼ç‰©è»Š
    function addToCart(item) {
        let cart = loadCart();
        
        // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„å•†å“ï¼ˆåç¨±å’Œå°ºå¯¸éƒ½ç›¸åŒï¼‰
        const existingIndex = cart.findIndex(cartItem => 
            cartItem.name === item.name && cartItem.size === item.size
        );
        
        if (existingIndex > -1) {
            // å¦‚æœå·²å­˜åœ¨ï¼Œå¢åŠ æ•¸é‡
            cart[existingIndex].quantity += item.quantity;
        } else {
            // å¦‚æœä¸å­˜åœ¨ï¼Œæ–°å¢å•†å“
            cart.push(item);
        }
        
        saveCart(cart);
        return cart.length;
    }
    
    // è¨ˆç®—è³¼ç‰©è»Šç¸½é‡‘é¡
    function getCartTotal() {
        const cart = loadCart();
        return cart.reduce((total, item) => total + item.total, 0);
    }
    
    // é¡¯ç¤ºè³¼ç‰©è»Šå…§å®¹åœ¨å¡«å–®è¡¨å–®ä¸­
    function displayCartInCheckout() {
        const cart = loadCart();
        if (cart.length === 0) return;
        
        // å»ºç«‹è³¼ç‰©è»Šå•†å“åˆ—è¡¨HTML
        let cartHtml = '<div style="border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden;">';
        cartHtml += '<table style="width: 100%; border-collapse: collapse;">';
        cartHtml += '<thead style="background: #f8f9fa;">';
        cartHtml += '<tr>';
        cartHtml += '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">å•†å“</th>';
        cartHtml += '<th style="padding: 10px; text-align: center; border-bottom: 2px solid #dee2e6;">å°ºå¯¸</th>';
        cartHtml += '<th style="padding: 10px; text-align: center; border-bottom: 2px solid #dee2e6;">æ•¸é‡</th>';
        cartHtml += '<th style="padding: 10px; text-align: right; border-bottom: 2px solid #dee2e6;">å°è¨ˆ</th>';
        cartHtml += '</tr>';
        cartHtml += '</thead>';
        cartHtml += '<tbody>';
        
        cart.forEach((item, index) => {
            cartHtml += '<tr style="' + (index % 2 === 0 ? 'background: #fff;' : 'background: #f9f9f9;') + '">';
            cartHtml += '<td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">' + item.name + '</td>';
            cartHtml += '<td style="padding: 12px; text-align: center; border-bottom: 1px solid #e0e0e0;">' + item.size + '</td>';
            cartHtml += '<td style="padding: 12px; text-align: center; border-bottom: 1px solid #e0e0e0;">' + item.quantity + ' æ¯</td>';
            cartHtml += '<td style="padding: 12px; text-align: right; border-bottom: 1px solid #e0e0e0; font-weight: 600; color: #FF69B4;">NT$ ' + item.total + '</td>';
            cartHtml += '</tr>';
        });
        
        cartHtml += '</tbody>';
        cartHtml += '</table>';
        cartHtml += '</div>';
        
        // å°‡HTMLæ’å…¥åˆ°é é¢
        document.getElementById('cartItemsList').innerHTML = cartHtml;
        
        // æ›´æ–°ç¸½é‡‘é¡
        const total = getCartTotal();
        document.getElementById('summaryTotal').textContent = 'NT$ ' + total;
        
        // å¡«å……éš±è—æ¬„ä½ - ä½¿ç”¨ JSON æ ¼å¼å„²å­˜æ‰€æœ‰å•†å“
        document.getElementById('hiddenProductName').value = JSON.stringify(cart);
    }
    
    // ç²å–çµå¸³å€åŸŸå…ƒç´ 
    const checkoutSection = document.getElementById('checkoutSection');
    
    // åŠ å…¥è³¼ç‰©è»Š - åœç•™åœ¨è³¼ç‰©è»Šé é¢
    const addToCartBtn = document.getElementById('addToCartBtn');
    if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // ç²å–ç•¶å‰é¸æ“‡çš„å•†å“è³‡è¨Š
            const selectedSizeInput = document.querySelector('input[name="size"]:checked');
            if (!selectedSizeInput) {
                alert('è«‹é¸æ“‡å°ºå¯¸ï¼');
                return;
            }
            
            const selectedSize = selectedSizeInput.value;
            const price = selectedSize === 'medium' ? mediumPrice : largePrice;
            const total = price * quantity;
            const sizeText = selectedSize === 'medium' ? 'ä¸­æ¯' : 'å¤§æ¯';
            
            // å»ºç«‹å•†å“ç‰©ä»¶
            const item = {
                name: itemName,
                size: sizeText,
                quantity: quantity,
                price: price,
                total: total,
                image: imageName
            };
            
            // åŠ å…¥è³¼ç‰©è»Š
            const cartCount = addToCart(item);
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            alert('âœ… å·²åŠ å…¥è³¼ç‰©è»Šï¼\n\n' + 
                  'å•†å“ï¼š' + itemName + '\n' +
                  'å°ºå¯¸ï¼š' + sizeText + '\n' +
                  'æ•¸é‡ï¼š' + quantity + ' æ¯\n' +
                  'å°è¨ˆï¼šNT$ ' + total + '\n\n' +
                  'è³¼ç‰©è»Šç›®å‰å…± ' + cartCount + ' é …å•†å“\n\n' +
                  'ğŸ’¡ æƒ³ç¹¼çºŒé¸è³¼ï¼Ÿé»æ“Šã€è¿”å›èœå–®ã€‘\n' +
                  'ğŸ’¡ ä¸å†æ–°å¢å“é …ï¼Ÿé»æ“Šã€ç«‹å³è³¼è²·ã€‘çµå¸³');
            
            // é‡ç½®æ•¸é‡ç‚º1ï¼ˆæ–¹ä¾¿ç”¨æˆ¶æ·»åŠ ä¸‹ä¸€å€‹å•†å“ï¼‰
            quantity = 1;
            quantityDisplay.textContent = quantity;
            updateTotal();
        });
    }
    
    // ç«‹å³è³¼è²· - é¡¯ç¤ºçµå¸³è¡¨å–®ï¼ˆçµå¸³è³¼ç‰©è»Šä¸­çš„æ‰€æœ‰å•†å“ï¼‰
    const buyNowBtn = document.getElementById('buyNowBtn');
    if (buyNowBtn) {
        buyNowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // æª¢æŸ¥è³¼ç‰©è»Šæ˜¯å¦æœ‰å•†å“
            let cart = loadCart();
            
            // å¦‚æœè³¼ç‰©è»Šç‚ºç©ºï¼Œå°‡ç•¶å‰å•†å“åŠ å…¥è³¼ç‰©è»Š
            if (cart.length === 0) {
                const selectedSizeInput = document.querySelector('input[name="size"]:checked');
                if (!selectedSizeInput) {
                    alert('è«‹é¸æ“‡å°ºå¯¸ï¼');
                    return;
                }
                
                const selectedSize = selectedSizeInput.value;
                const price = selectedSize === 'medium' ? mediumPrice : largePrice;
                const total = price * quantity;
                const sizeText = selectedSize === 'medium' ? 'ä¸­æ¯' : 'å¤§æ¯';
                
                const item = {
                    name: itemName,
                    size: sizeText,
                    quantity: quantity,
                    price: price,
                    total: total,
                    image: imageName
                };
                
                addToCart(item);
                cart = loadCart();
            }
            
            // é¡¯ç¤ºè³¼ç‰©è»Šå…§å®¹åœ¨å¡«å–®è¡¨å–®ä¸­
            displayCartInCheckout();
            
            // å¡«å……ç¸½é‡‘é¡åˆ°éš±è—æ¬„ä½
            const totalAmount = getCartTotal();
            document.getElementById('hiddenTotalAmount').value = totalAmount;
            
            // é¡¯ç¤ºçµå¸³å€åŸŸä¸¦æ»¾å‹•åˆ°è©²ä½ç½®
            checkoutSection.style.display = 'block';
            checkoutSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
    }
    
    // å–æ¶ˆçµå¸³æŒ‰éˆ•
    const cancelCheckoutBtn = document.getElementById('cancelCheckoutBtn');
    if (cancelCheckoutBtn) {
        cancelCheckoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            checkoutSection.style.display = 'none';
            // æ»¾å‹•å›é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
    
    // å–è²¨æ–¹å¼é¸æ“‡è™•ç†
    const deliveryTypeSelect = document.getElementById('deliveryType');
    const addressGroup = document.getElementById('addressGroup');
    const addressInput = document.getElementById('customerAddress');
    
    if (deliveryTypeSelect) {
        deliveryTypeSelect.addEventListener('change', function() {
            const deliveryType = this.value;
            if (deliveryType === 'å¤–é€') {
                addressGroup.style.display = 'block';
                addressInput.setAttribute('required', 'required');
            } else if (deliveryType === 'è‡ªå–') {
                addressGroup.style.display = 'none';
                addressInput.removeAttribute('required');
                addressInput.value = ''; // æ¸…ç©ºåœ°å€æ¬„ä½
            } else {
                addressGroup.style.display = 'none';
                addressInput.removeAttribute('required');
            }
        });
    }
    
    // è¡¨å–®æäº¤å‰é©—è­‰
    const checkoutForm = document.getElementById('checkoutForm');
    if (checkoutForm) {
        checkoutForm.addEventListener('submit', function(e) {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();
            const deliveryType = document.getElementById('deliveryType').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (!customerName || !customerPhone || !customerEmail || !deliveryType || !paymentMethod) {
                alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½ï¼');
                e.preventDefault();
                return false;
            }
            
            // é©—è­‰é›»è©±æ ¼å¼
            const phonePattern = /^[0-9]{10}$/;
            if (!phonePattern.test(customerPhone)) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„10ä½æ•¸æ‰‹æ©Ÿè™Ÿç¢¼ï¼');
                e.preventDefault();
                return false;
            }
            
            // é©—è­‰Emailæ ¼å¼
            const emailPattern = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
            if (!emailPattern.test(customerEmail)) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„Emailæ ¼å¼ï¼');
                e.preventDefault();
                return false;
            }
            
            // å¦‚æœé¸æ“‡å¤–é€ï¼Œæª¢æŸ¥åœ°å€æ˜¯å¦å¡«å¯«
            if (deliveryType === 'å¤–é€') {
                const address = document.getElementById('customerAddress').value.trim();
                if (!address) {
                    alert('è«‹å¡«å¯«å¤–é€åœ°å€ï¼');
                    e.preventDefault();
                    return false;
                }
            }
            
            // ç¢ºèªè¨‚å–®
            const cart = loadCart();
            let confirmMsg = 'ç¢ºèªé€å‡ºè¨‚å–®ï¼Ÿ\n\n';
            
            if (cart.length > 0) {
                confirmMsg += 'è¨‚è³¼å•†å“ï¼š\n';
                cart.forEach((item, index) => {
                    confirmMsg += (index + 1) + '. ' + item.name + ' (' + item.size + ') x ' + item.quantity + ' æ¯\n';
                });
                confirmMsg += '\n';
            }
            
            confirmMsg += 'å–è²¨æ–¹å¼ï¼š' + deliveryType + '\n';
            confirmMsg += 'ç¸½é‡‘é¡ï¼šNT$ ' + document.getElementById('hiddenTotalAmount').value;
            
            if (!confirm(confirmMsg)) {
                e.preventDefault();
                return false;
            }
            
            // æäº¤æˆåŠŸå¾Œæ¸…ç©ºè³¼ç‰©è»Š
            clearCart();
            
            return true;
        });
    }
    
    console.log('æ‰€æœ‰äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®å®Œæˆï¼');
});
</script>
